<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SiSocial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
.box{max-width:420px;margin:auto;padding:15px}
.hidden{display:none}
button,input,textarea{width:100%;margin:5px 0;padding:10px;border-radius:6px;border:none}
button{background:#4caf50;color:#fff;font-weight:bold}
.secondary{background:#2196f3}
.post{background:#1e1e1e;margin:10px 0;padding:10px;border-radius:8px}
img,video{max-width:100%;border-radius:8px;margin-top:5px}
video{max-height:300px}
.small{font-size:12px;color:#aaa}
.comment{background:#222;padding:5px;margin:5px 0;border-radius:5px}
.like{cursor:pointer;color:#4caf50}
</style>
</head>

<body>

<div class="box" id="inicio">
<h2>SiSocial</h2>
<button onclick="showLogin()">Entrar</button>
<button class="secondary" onclick="showCadastro()">Criar conta</button>
</div>

<div class="box hidden" id="cadastro">
<h3>Criar conta</h3>
<input id="nome">
<input id="codigo" maxlength="4" inputmode="numeric" placeholder="C√≥digo 4 d√≠gitos">
<input type="file" id="foto" accept="image/*">
<button onclick="criarConta()">Criar</button>
<button onclick="back()">Voltar</button>
</div>

<div class="box hidden" id="login">
<h3>Entrar</h3>
<input id="codigoLogin" maxlength="4" inputmode="numeric">
<button onclick="entrar()">Entrar</button>
<button onclick="back()">Voltar</button>
</div>

<div class="box hidden" id="app">
<h3 id="userName"></h3>

<textarea id="postTexto" placeholder="O que est√° pensando?"></textarea>
<input type="file" id="postImg" accept="image/*">
<input type="file" id="postVideo" accept="video/*">
<input type="file" id="postFile">
<button onclick="postar()">Postar</button>

<h3>Feed</h3>
<div id="feed"></div>

<button onclick="verMeusPosts()">Ver meus posts</button>
<button onclick="logout()">Sair</button>
</div>

<script>
let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
let posts = JSON.parse(localStorage.getItem("posts")) || [];
let logado = null;

function hideAll(){document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"))}
function back(){hideAll();inicio.classList.remove("hidden")}
function showLogin(){hideAll();login.classList.remove("hidden")}
function showCadastro(){hideAll();cadastro.classList.remove("hidden")}

function criarConta(){
 let nome=nome.value.trim(),cod=codigo.value.trim();
 if(!nome||cod.length!==4) return alert("Erro");
 if(usuarios.find(u=>u.codigo===cod)) return alert("J√° existe");
 let r=new FileReader();
 r.onload=()=>{
  usuarios.push({nome,codigo:cod,foto:r.result});
  localStorage.setItem("usuarios",JSON.stringify(usuarios));
  alert("Criado");
  showLogin();
 };
 foto.files[0]?r.readAsDataURL(foto.files[0]):r.onload();
}

function entrar(){
 let cod=codigoLogin.value.trim();
 let u=usuarios.find(u=>u.codigo===cod);
 if(!u) return alert("N√£o encontrado");
 logado=u;
 hideAll();
 app.classList.remove("hidden");
 userName.innerText=u.nome;
 renderFeed();
}

function logout(){logado=null;back()}

function postar(){
 let texto=postTexto.value;
 if(!texto && !postImg.files[0] && !postVideo.files[0] && !postFile.files[0])
 return alert("Post vazio");

 let p={id:Date.now(),user:logado.codigo,texto,likes:[],comentarios:[]};

 let load=()=>{posts.unshift(p);savePosts();clearPost();renderFeed();};

 if(postImg.files[0]){
  let r=new FileReader();
  r.onload=()=>{p.img=r.result;load()};
  r.readAsDataURL(postImg.files[0]);return;
 }
 if(postVideo.files[0]){
  let r=new FileReader();
  r.onload=()=>{p.video=r.result;load()};
  r.readAsDataURL(postVideo.files[0]);return;
 }
 if(postFile.files[0]){
  let r=new FileReader();
  r.onload=()=>{p.file={name:postFile.files[0].name,data:r.result};load()};
  r.readAsDataURL(postFile.files[0]);return;
 }
 load();
}

function clearPost(){postTexto.value="";postImg.value="";postVideo.value="";postFile.value=""}

function savePosts(){localStorage.setItem("posts",JSON.stringify(posts))}

function renderFeed(list=posts){
 feed.innerHTML="";
 list.forEach(p=>{
  let u=usuarios.find(x=>x.codigo===p.user);
  let d=document.createElement("div");
  d.className="post";
  d.innerHTML=`
   <b>${u.nome}</b>
   <p>${p.texto||""}</p>
   ${p.img?`<img src="${p.img}">`:""}
   ${p.video?`<video src="${p.video}" autoplay muted loop playsinline></video>`:""}
   ${p.file?`<a href="${p.file.data}" download="${p.file.name}">üìé ${p.file.name}</a>`:""}
   <div class="like" onclick="like(${p.id})">‚ù§Ô∏è ${p.likes.length}</div>
   <div>
    <input placeholder="Comentar..." onkeydown="if(event.key==='Enter')comentar(${p.id},this)">
   </div>
   ${p.comentarios.map(c=>`<div class="comment"><b>${c.nome}:</b> ${c.txt}</div>`).join("")}
  `;
  feed.appendChild(d);
 });
}

function like(id){
 let p=posts.find(p=>p.id===id);
 let i=p.likes.indexOf(logado.codigo);
 i==-1?p.likes.push(logado.codigo):p.likes.splice(i,1);
 savePosts();renderFeed();
}

function comentar(id,el){
 let p=posts.find(p=>p.id===id);
 p.comentarios.push({nome:logado.nome,txt:el.value});
 el.value="";
 savePosts();renderFeed();
}

function verMeusPosts(){
 renderFeed(posts.filter(p=>p.user===logado.codigo));
}
</script>

</body>
</html>