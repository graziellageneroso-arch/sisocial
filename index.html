<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SiSocial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{padding:10px;background:#222;text-align:center}
input,button,textarea{width:100%;margin:5px 0;padding:8px}
button{cursor:pointer;background:#1da1f2;color:white;border:none}
#app{padding:10px}
.post{background:#222;padding:10px;margin:10px 0;border-radius:8px}
.like{cursor:pointer;color:#1da1f2}
</style>
</head>

<body>
<header>
<h2>SiSocial</h2>
</header>

<div id="app">

<div id="auth">
<input id="user" placeholder="Usuário">
<input id="pass" type="password" placeholder="Senha">
<button onclick="criarConta()">Criar conta</button>
<button onclick="entrar()">Entrar</button>
</div>

<div id="social" style="display:none">
<p>Logado como: <b id="logado"></b></p>
<button onclick="sair()">Sair</button>

<h3>Novo post</h3>
<textarea id="postText" placeholder="O que você está pensando?"></textarea>
<button onclick="postar()">Postar</button>

<h3>Feed</h3>
<div id="feed"></div>
</div>

</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyClDT4Yl4nSOGLOR5sVXlnaf9pwnYjZHAw",
  authDomain: "sisocial.firebaseapp.com",
  projectId: "sisocial",
  storageBucket: "sisocial.firebasestorage.app",
  messagingSenderId: "25069295126",
  appId: "1:25069295126:web:b460d4ccbeb77e529b0737"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let atual = localStorage.getItem("atual");

// ---------- AUTH ----------
window.criarConta = async function(){
  let u=user.value.trim(), p=pass.value;
  if(!u||!p) return alert("Preencha tudo");

  const usersRef = collection(db,"users");
  const snap = await getDocs(usersRef);

  if(snap.docs.some(d=>d.data().user===u))
    return alert("Usuário já existe");

  await addDoc(usersRef,{user:u,pass:p});
  atual = u;
  localStorage.setItem("atual",u);
  mostrar();
}

window.entrar = async function(){
  let u=user.value,p=pass.value;
  const snap = await getDocs(collection(db,"users"));
  const ok = snap.docs.find(d=>d.data().user===u && d.data().pass===p);
  if(!ok) return alert("Dados inválidos");
  atual=u;
  localStorage.setItem("atual",u);
  mostrar();
}

window.sair=function(){
  localStorage.removeItem("atual");
  location.reload();
}

// ---------- POSTS ----------
window.postar = async function(){
  let t = postText.value.trim();
  if(!t) return;
  await addDoc(collection(db,"posts"),{
    user: atual,
    text: t,
    likes: 0,
    time: Date.now()
  });
  postText.value="";
  render();
}

window.like = async function(id, likes){
  await addDoc(collection(db,"likes"),{post:id}); // simples por enquanto
}

// ---------- RENDER ----------
async function render(){
  feed.innerHTML="Carregando...";
  const q = query(collection(db,"posts"), orderBy("time","desc"));
  const snap = await getDocs(q);

  feed.innerHTML="";
  snap.forEach(doc=>{
    const p=doc.data();
    const div=document.createElement("div");
    div.className="post";
    div.innerHTML=`
      <b>${p.user}</b>
      <p>${p.text}</p>
    `;
    feed.appendChild(div);
  });
}

function mostrar(){
  auth.style.display="none";
  social.style.display="block";
  logado.innerText=atual;
  render();
}

if(atual) mostrar();
</script>

</body>
</html>