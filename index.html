<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SiSocial</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Ícone embutido -->
<link rel="icon" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<rect width='100' height='100' rx='22' fill='black'/>
<text x='50%' y='65%' text-anchor='middle' font-size='70' fill='lime' font-family='Arial'>S</text>
</svg>">

<meta name="theme-color" content="#000">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
.hidden{display:none}
.box{background:#1c1c1c;padding:10px;margin:10px;border-radius:10px}
input,textarea,button{width:100%;padding:8px;margin:4px 0;border-radius:6px;border:none}
button{background:lime;color:#000;font-weight:bold}
.post{border-top:1px solid #333;padding:8px}
.post img{max-width:100%;border-radius:8px}
.chatbox{height:150px;overflow:auto;background:#000;padding:8px;border-radius:8px}
.profile{display:flex;gap:10px;align-items:center}
.profile img{width:60px;height:60px;border-radius:50%;object-fit:cover}

/* Splash */
#splash{
position:fixed;inset:0;background:#000;
display:flex;align-items:center;justify-content:center;
flex-direction:column;z-index:9999;
animation:fadeout 1s ease 3s forwards;
}
#logo{font-size:80px;color:lime;animation:scale 1.5s ease;}
#name{opacity:0;animation:show 1s ease 1.5s forwards;}
@keyframes scale{from{transform:scale(0)}to{transform:scale(1)}}
@keyframes show{to{opacity:1}}
@keyframes fadeout{to{opacity:0;visibility:hidden}}
</style>
</head>
<body>

<div id="splash">
  <div id="logo">S</div>
  <div id="name">SiSocial</div>
</div>

<div id="loginBox" class="box">
  <input id="loginName" placeholder="Nome">
  <input id="loginYear" type="number" placeholder="Ano de nascimento">
  <button onclick="login()">Entrar</button>
</div>

<div id="registerBox" class="box">
  <input id="regName" placeholder="Nome">
  <input id="regYear" type="number" placeholder="Ano nascimento">
  <textarea id="regBio" placeholder="Bio"></textarea>
  <input id="regPhoto" type="file" accept="image/*">
  <button onclick="register()">Cadastrar</button>
</div>

<div id="app" class="hidden">

  <div class="box profile">
    <img id="mePhoto">
    <div><b id="meName"></b><br><small id="meBio"></small></div>
  </div>

  <div class="box">
    <textarea id="postText" placeholder="Texto"></textarea>
    <input id="postImage" type="file" accept="image/*">
    <button onclick="post()">Postar</button>
  </div>

  <div class="box">
    <h3>Feed</h3>
    <div id="feed"></div>
  </div>

  <div class="box">
    <h3>Chat</h3>
    <div id="chat" class="chatbox"></div>
    <input id="chatInput" placeholder="Mensagem">
    <button onclick="sendChat()">Enviar</button>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyClDT4Yl4nSOGLOR5sVXlnaf9pwnYjZHAw",
  authDomain: "sisocial.firebaseapp.com",
  projectId: "sisocial",
  storageBucket: "sisocial.firebasestorage.app",
  messagingSenderId: "25069295126",
  appId: "1:25069295126:web:b460d4ccbeb77e529b0737"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

let me = null;

// CADASTRO (com login automático)
async function register(){
  try {
    const n = regName.value.trim();
    const y = +regYear.value;
    const b = regBio.value.trim();
    const f = regPhoto.files[0];

    if(!n||!y||!f) return alert("Preencha tudo");
    if(new Date().getFullYear()-y < 9) return alert("Precisa 9+");

    const userRef = db.collection("users").doc(n);
    const snap = await userRef.get();
    if(snap.exists) return alert("Nome já existe");

    const ref = storage.ref("profiles/" + n);
    await ref.put(f);
    const url = await ref.getDownloadURL();

    const userData = { name:n, year:y, bio:b, photo:url };
    await userRef.set(userData);

    me = userData;
    start();

  } catch (e) {
    alert("Erro cadastro: " + e.message);
  }
}

// LOGIN
async function login(){
  try {
    const n = loginName.value.trim();
    const y = +loginYear.value;

    if(!n||!y) return alert("Preencha nome e ano");

    const doc = await db.collection("users").doc(n).get();
    if(!doc.exists) return alert("Usuário não existe");

    const data = doc.data();
    if(data.year !== y) return alert("Ano errado");

    me = data;
    start();

  } catch (e) {
    alert("Erro login: " + e.message);
  }
}

// START
function start(){
  loginBox.classList.add("hidden");
  registerBox.classList.add("hidden");
  app.classList.remove("hidden");
  meName.innerText = me.name;
  meBio.innerText = me.bio;
  mePhoto.src = me.photo;
  loadFeed();
  loadChat();
}

// POST
async function post(){
  const text = postText.value;
  const file = postImage.files[0];
  if(!text && !file) return;

  let imageUrl = "";
  if(file){
    const ref = storage.ref("posts/" + Date.now());
    await ref.put(file);
    imageUrl = await ref.getDownloadURL();
  }

  await db.collection("posts").add({
    author: me.name,
    text,
    image: imageUrl,
    time: Date.now()
  });

  postText.value = "";
  postImage.value = "";
  loadFeed();
}

// FEED
async function loadFeed(){
  feed.innerHTML = "";
  const snap = await db.collection("posts").orderBy("time","desc").get();
  snap.forEach(doc=>{
    const p = doc.data();
    feed.innerHTML += `
      <div class="post">
        <b>${p.author}</b><br>
        ${p.text||""}<br>
        ${p.image?`<img src="${p.image}">`:""}
      </div>`;
  });
}

// CHAT
async function sendChat(){
  if(!chatInput.value) return;
  await db.collection("chat").add({
    user: me.name,
    text: chatInput.value,
    time: Date.now()
  });
  chatInput.value="";
  loadChat();
}

async function loadChat(){
  chat.innerHTML="";
  const snap = await db.collection("chat").orderBy("time").get();
  snap.forEach(d=>{
    const m=d.data();
    chat.innerHTML += `${m.user}: ${m.text}<br>`;
  });
}
</script>
</body>
</html>